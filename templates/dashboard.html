{% extends 'base.html' %}
{% block title %}CredSafe â€” Dashboard{% endblock %}
{% block nav_dashboard_active %}active{% endblock %}
{% block head_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% endblock %}
{% block content %}
  <!-- KPIs -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4">
      <div class="kpi">
        <div class="muted">Total Transactions</div>
        <div class="num">{{ kpis.total_transactions|default:0 }}</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="kpi">
        <div class="muted">Fraud Rate</div>
        <div class="num">{% if kpis.fraud_rate %}{{ kpis.fraud_rate }}%{% else %}N/A{% endif %}</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="kpi">
        <div class="muted">Target Column</div>
        <div class="num">{{ target_col|default:'N/A' }}</div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row g-4">
    <div class="col-12 col-lg-6">
      <div class="p-3 glass">
        <h6 class="mb-3">Class Distribution</h6>
        <canvas id="classDist"></canvas>
        {% if not has_data %}
          <div class="alert alert-warning mt-3">No data available. Place the raw CSV at artifacts/raw/ and reload.</div>
        {% endif %}
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="p-3 glass">
        <h6 class="mb-3">Amount Distribution</h6>
        <canvas id="amountHist"></canvas>
      </div>
    </div>
  </div>

  <div class="text-center mt-4 muted">Built with Django, Bootstrap and Chart.js</div>
{% endblock %}
{% block body_scripts %}
<script>
  const charts = {{ charts_json|safe }};
  const cdCtx = document.getElementById('classDist');
  if (cdCtx && charts.classDist.labels.length > 0) {
    new Chart(cdCtx, { type: 'pie', data: { labels: charts.classDist.labels, datasets: [{ data: charts.classDist.values, backgroundColor: ['#60a5fa','#f87171','#34d399','#fbbf24','#a78bfa'], borderWidth: 0 }] }, options: { plugins: { legend: { labels: { color: '#e5e7eb' } } } } });
  }
  const ahCtx = document.getElementById('amountHist');
  if (ahCtx && charts.amountHist.labels.length > 0) {
    new Chart(ahCtx, { type: 'bar', data: { labels: charts.amountHist.labels, datasets: [{ label: charts.amountHist.label, data: charts.amountHist.values, backgroundColor: '#34d399', borderWidth: 0 }] }, options: { scales: { x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.06)' } }, y: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.06)' } } }, plugins: { legend: { labels: { color: '#e5e7eb' } } } } });
  }
</script>
{% endblock %}