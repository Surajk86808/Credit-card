{% extends 'base.html' %}
{% block title %}CredSafe â€” Fraud Predictor{% endblock %}
{% block nav_predict_active %}active{% endblock %}
{% block head_extra %}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
  <style>
    body { background: radial-gradient(100% 100% at 50% 0%, #0f172a 0%, #111827 100%); }
    .glass { background: rgba(255, 255, 255, 0.08); border-radius: 16px; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); backdrop-filter: blur(7.3px); border: 1px solid rgba(255, 255, 255, 0.15); }
    .hero-title { font-weight: 800; letter-spacing: .5px; }
    .badge-soft { background-color: rgba(59,130,246,.15); color: #93c5fd; }
    .btn-gradient { background: linear-gradient(90deg,#06b6d4 0%,#3b82f6 50%,#8b5cf6 100%); color: #fff; border: 0; transition: transform .1s ease-in-out; }
    .btn-gradient:hover { transform: translateY(-1px) scale(1.01); }
    .result-card { border-left: 6px solid #22c55e; }
    .result-card.danger { border-left-color: #ef4444; }
    .form-label { color: #cbd5e1; }
  </style>
{% endblock %}
{% block content %}
  <div class="row justify-content-center mb-4">
    <div class="col-12 col-lg-8">
      <div class="p-4 p-md-5 glass animate__animated animate__fadeInDown">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <span class="badge badge-soft px-3 py-2">AI Powered</span>
          <span class="text-muted">Logistic Regression</span>
        </div>
        <h1 class="display-6 hero-title mb-2">Credit Card Fraud Detection</h1>
        <p class="mb-0">Enter transaction details to check if it is likely <strong>Fraud</strong> or <strong>Not Fraud</strong>. The UI is responsive and animated for a smooth experience.</p>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12 col-lg-7">
      <div class="p-4 glass animate__animated animate__fadeInLeft">
        <h5 class="mb-3">Transaction Details</h5>
        <form method="post" novalidate>
          {% csrf_token %}
          {% if feature_names %}
          <div class="row g-3">
            {% for field in form %}
            <div class="col-12 col-md-6">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
              <div class="text-danger small">{{ field.errors|striptags }}</div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          <div class="mt-4 d-grid d-md-flex gap-2">
            <button class="btn btn-gradient px-4 py-2 animate__animated animate__pulse" type="submit">Predict</button>
            <a class="btn btn-outline-light px-4 py-2" href="{%- url 'home' -%}">Reset</a>
          </div>
          {% else %}
          <div class="alert alert-warning" role="alert">Could not infer feature names. Ensure the raw CSV exists or a feature_names.pkl is available.</div>
          {% endif %}
        </form>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      <div class="p-4 glass animate__animated animate__fadeInRight">
        <h5 class="mb-3">Result</h5>
        {% if prediction is not None %}
        <div class="card result-card {% if prediction == 1 %}danger{% endif %} animate__animated animate__fadeInUp">
          <div class="card-body">
            {% if prediction == 1 %}
            <h4 class="text-danger">Fraudulent Transaction</h4>
            {% else %}
            <h4 class="text-success">Not Fraud</h4>
            {% endif %}
            {% if probability %}
            <p class="mb-0 text-muted">Model confidence (probability of fraud): <strong>{{ probability|floatformat:3 }}</strong></p>
            {% endif %}
          </div>
        </div>
        {% else %}
        <p class="text-muted">Submit the form to see prediction.</p>
        {% endif %}
      </div>

      <div class="p-4 glass mt-3">
        <h6 class="mb-2">Tips</h6>
        <ul class="mb-0">
          <li>All inputs are treated as numeric features.</li>
          <li>Order and number of features must match training.</li>
          <li>If you need categorical fields, we can add custom widgets and encoders.</li>
        </ul>
      </div>
    </div>
  </div>
{% endblock %}
